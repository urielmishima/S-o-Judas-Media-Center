<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link rel="stylesheet" href="/css/upload.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css">
    <link rel="icon" href="/img/cropped-favicon-1-32x32.png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Upload</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-light">
        <a href="home.html" class="navbar-brand mx-auto"><img src="/img/logo-mediacenter.png" alt="Logo Media Center"
                style="width: 210px"></a>
    </nav>

    <div class="bg-light">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="nav-link active" href="home.html">Dashboard</a>
                <a class="nav-link" href="#">
                    Usuários
                    <span class="badge badge-pill bg-light align-text-bottom">27</span>
                </a>
                <a class="nav-link" href="#">Atualizações</a>
                <a class="nav-link" href="#">Sugestões</a>
                <a class="nav-link" href="upload.html">Upload</a>
                <a class="nav-link" href="confeccao.html">Confecção</a>
            </div>
        </nav>
    </div>


    <div class="container">
        <div class="row">
            <div class="col-sm-12 col-lg-12">
                <div class="card mt-5">
                    <div class="card-header text-center">Faça upload de conteúdo</div>
                    <div class="card-body">
                        <form action="/materiais/upload" method="post" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="tags">Tags</label>
                                <input type="text" name="adicionar-tags" id="adicionar-tags" class="form-control" autofocus>
                            </div>
                            <div class="form-group">
                                <input type="file" name="file" id="file" class="form-control">
                            </div>
                            <div class="form-group">
                            	<h6>Tipo de Acesso: </h6>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="acesso" id="livre" class="form-control">
                                        Material livre ao público
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="acesso" id="protegido" class="form-control">
                                        Livre acesso mediante a cadastro
                                    </label>
                                </div>
                            </div>
							<h6>Categorias: </h6>
                            <div class="row categorias-carregar">                            	
                                <div class="col-sm-6 col-lg-3 " th:each="categoria : ${categorias}">
                                    <div class="checkbox">
                                        <label>
                                            <input class="categorias" type="checkbox" name="categorias" th:id="${categoria.id}" th:text="${categoria.nome}">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <input type="text" name="adicionar-categorias" class="form-control adicionar-categorias">
                             <br>
                            <button type="submit" class="btn" data-toggle="snackbar" data-content="Conteúdo enviado com sucesso!" data-html-allowed="true" data-timeout="0">Enviar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div> 
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"></script>
    <script>$(document).ready(function () { $('body').bootstrapMaterialDesign(); });</script>
    <script type="text/javascript">
    	$(document).ready(function () {
    		$('form').keypress(function(e) {
                if ((e.keyCode == 10)||(e.keyCode == 13)) {
                    e.preventDefault();
                }
            });
    		$('.adicionar-categorias').keypress(function(event){
	            var keycode = (event.keyCode ? event.keyCode : event.which);
	            if(keycode == '13'){
	            	var categoria  = $('.adicionar-categorias').val();
	            	$.post(`/categorias/cadastrar/${categoria}`,function(data, status){
	            		$('.adicionar-categorias').val("");
	            		var tem = false;
	            		$('.categorias').each(function(index, element) {
	            			console.log(element.value);  
	            			if(element.value == `${data.nome}`){
	            				  element.checked = true;
	            				  tem =  true;
	            			  }
	            			  else {
	            				  console.log("diferente");
	            			  }
	            		});
	            		console.log(tem);
	            		if(!tem){
	            			var categoriaTemplate = `<div class="col-sm-6 col-lg-3">` +
		            									`<span class="bmd-form-group is-filled">`+
		            										`<div class="checkbox">`+
									                            `<label>` +
									                                `<input class="categorias" type="checkbox" name="categorias" id="${data.id}" checked="true"> ${data.nome}` +
												                  	`<span class="checkbox-decorator">` +
													                  	`<span class="check">` +
													                  	`</span>` +
												                  	`</span>` +
									                            `</label>` +
										                    `</div>` +
										                 `</span>` +
									                 `</div>`		
							console.log(categoriaTemplate)
							console.log($(".categorias-carregar"))
							$(".categorias-carregar").append(categoriaTemplate);
	            		}
	            	});
	            }
	        });
    	});
    </script>
</body>

</html>